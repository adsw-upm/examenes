---
id: ex-2015-01
year: 2015
exam: parcial 2
tags:
 - android
---

Se pretende desarrollar una aplicación para Android de gestión de una colección de libros. La información de los libros se almacena en una Base de Datos sqlite. Una ListActivity muestra información de los libros
almacenados.

De los libros se almacena la siguiente información: Autor, Título, Año de publicación. Los dos primeros campos serán textuales, el último será un número. La Bases de Datos constará de una única tabla que
contenga esta información.

- (a) (1 punto) Escriba la sentencia SQL correcta para la creación de la Base de Datos.

??? note "Mostrar solución"
    ```SQL
    CREATE TABLE libros (_id INTEGER PRIMARY KEY AUTOINCREMENT, Autor TEXT NOT NULL, Titulo TEXT NOT NULL, Año INTEGER NOT NULL)
    ```

Se decide programar un adaptador para manejar la base de datos. Parte de dicho adaptador es la siguiente:

```java
public class DatabaseHelper {
    private SQLiteDatabase database;
    private MySQLiteHelper dbHelper;
    private static final int DATABASE_VERSION = 1;
    private static final String DATABASE_NAME = "libros.db";
    …

    private class MySQLiteHelper extends SQLiteOpenHelper
    {
        @Override
        public void onCreate(SQLiteDatabase db) { … }
        …
    }
}
```

- (b) (1 punto) Escriba un método de la clase DatabaseHelper que devuelva un Cursor con la información de todos los libros. La cabecera del método será: public Cursor selectAll() { … }. Si necesita atributos adicionales, declárelos correctamente. No duplique las declaraciones de la pregunta anterior.

??? note "Mostrar solución"
    ```java
    public Cursor recuperaTodosLosLibros() {
        return db.query("libros", new String[] {
            COL_ID, COL_AUTOR, COL_TITULO, COL_ANYO
        }, null, null, null, null, null);
    }
    ```



Se pretende disponer de una actividad ListaLibrosActivity, que herede de ListActivity, según el siguiente esquema:

```java
public class ListaLibrosActivity extends ListActivity {
    private DatabaseHelper dbHelper;
    private SimpleCursorAdapter cursorAdapter;
    …
}
```

- (c) (2 puntos) Se pretende que dicha actividad reaccione de forma que cuando el usuario pulse sobre un registro mostrado en el ListView, se lance otra actividad, llamada “EditarLibroActivity”, que ya está ya implementada. A la actividad “EditarLibroActivity” se le ha de pasar toda la información del libro seleccionado. Escriba el código necesario para implementar este comportamiento. 

??? note "Mostrar solución"
    ```java
    public void onListItemClick(ListView l, View v, int position, long id) {
        super.onListItemClick(l, v, position, id);
        Cursor c = productosCursor;
        c.moveToPosition(position);
        Intent intent = new Intent(this, EditarLibroActivity.class);
        intent.putExtra(ProductoDbAdaptador.COL_ID, id);
        intent.putExtra(Producto.AUTOR, c.getString(indiceAutor));
        intent.putExtra(Producto.TITULO, c.getInt(indiceTitulo));
        intent.putExtra(Producto.ANYO, c.getInt(indiceAnyo));
        intent.putExtra(REQUEST_CODE, MODIFICA_PRODUCTO);
        startActivityForResult(intent, MODIFICA_PRODUCTO);
    }
    ```


- (d) (1 punto) Se desea guardar la base de datos de forma automática, cuando la aplicación sea interrumpida por otra ACTIVIDAD (por ejemplo, una llamada de teléfono o pulsar el botón de aplicaciones). Cuando se vuelva a la
aplicación, se debe cargar la base de datos. ¿Qué métodos han de sobrecargarse relativos al ciclo de vida de la actividad principal? Ponga SÓLO el nombre de los métodos.

??? note "Mostrar solución"
    sol a) onStart() – onStop() sol b) onResume() – onPause()
