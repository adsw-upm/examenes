---
id: ex-2015-02
year: 2015
exam: parcial 1
tags:
 - monitores
---

- (a) (4 puntos) Se pretende sincronizar la fabricación en una línea de ensamblado de mesas. Hay varios fabricantes de patas, que las depositan en una línea con un límite de capacidad MAX_NUM_PATAS. Cuando se llena, los fabricantes dejan de producir patas hasta que haya hueco libre. Hay varios fabricantes de tableros, que depositan en otra línea de capacidad limitada MAX_NUM_TABLEROS. Por último, hay varios ensambladores de mesas: cada uno coge cuatro patas y un tablero y ensambla una mesa. 
 
Se trata de escribir en Java un monitor que sincronice estos tres sistemas, de forma que la producción se detenga cuando se alcanza la capacidad máxima de almacenamiento (de patas o tableros independientemente) y sistema de ensamblaje no avance si le faltan piezas para hacer una nueva mesa. 
 
NO ESCRIBA NINGÚN CÓDIGO para los subsistemas de producción y ensamblaje. 
 
El sincronizador responde al siguiente esquema:
```java
class Sincronizador { 
    ...  
    ... ponPata() {...}    // lo invoca el productor de patas por cada una 
    ... ponTablero() {...} // lo invoca el productor de tableros 
    ... cogePatasyTablero () {...}   // lo invoca el ensamblador de mesas 
    ... 
} 
```
Se pide: Desarrollar el código completo del monitor sincronizador.

??? note "Mostrar solución"
    Una posible implementación es:
    ```java
    package es.upm.dit.adsw.em;

    public class Sincronizador {

       private static final int NUM_MAX_PATAS    = 10;
       private static final int NUM_MAX_TABLEROS = 4;
       private int numPatas = 0;
       private int numTableros = 0;

       public synchronized void ponTablero() throws InterruptedException {
          while (numTableros >= NUM_MAX_TABLEROS)
          {
             wait();
          }

          numTableros++;

          notifyAll();
       }

       public synchronized void ponPatas() throws InterruptedException {
          while (numPatas >= NUM_MAX_PATAS)
          {
             wait();
          }

          numPatas++;

          notifyAll();
       }

       public synchronized void cogePatasyTablero() throws InterruptedException {
          while (numTableros < 1 || numPatas < 4)
          {
             wait();
          }

          numTableros--;
          numPatas -= 4;

          notifyAll();
       }

    }
    ```