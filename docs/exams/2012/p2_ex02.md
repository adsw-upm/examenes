---
id: ex-2012-02
year: 2012
exam: parcial 2
tags:
  - hebras
---

- (a) (4 puntos) Escriba una clase con un contador interno, que se incrementa cada vez que se invoca el método `siguiente()`. La clase debe poderse utilizar en un programa concurrente. Además, la clase proporciona otros dos métodos, `esperarPar()` y `esperarImpar()`, que hacen que la hebra (thread) que los invoca se quede bloqueada hasta que el valor del contador sea par o impar, respectivamente.

Se supone que el intervalo entre dos invocaciones consecutivas de `siguiente()` es suficiente para que todas las hebras que estuvieran bloqueadas puedan continuar.

El esquema de la clase es el siguiente:

```java
public class Secuenciador  {
    private int numero = 0;

    public int siguiente() {...}
    // devuelve 1 la primera vez que se invoca, 2 la segunda, etc.

    public void esperarPar() {...}
    // suspende la ejecución de la hebra hasta que el valor sea par

    public void esperarImpar() {...}
    // suspende la ejecución de la hebra hasta que el valor sea impar
}
```

??? note "Mostrar solución"
	Los métodos deben ser todos sincronizados. Además, se deben incluir esperas condicionales en `esperarPar` y `esperarImpar`. Como el único método que modifica el valor del contador es `siguiente`, el aviso (`notifyAll`) para que las hebras bloqueadas vuelvan a comprobar la condición debe estar en este método.

	Una posible implementación es:

	```java
	public class Secuenciador {
		private int numero = 0;

		public synchronized int siguiente() {
			numero++;
			notifyAll();
			return numero;
		}

		public synchronized void esperarPar() {
			while (numero % 2 != 0) {
				try {
					wait();
				} catch (InterruptedException e) {
					// manejar excepción
				}
			}
		}

		public synchronized void esperarImpar() {
			while (numero % 2 == 0) {
				try {
					wait();
				} catch (InterruptedException e) {
					// manejar excepción
				}
			}
		}
	}
	```
