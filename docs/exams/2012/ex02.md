---
id: ex-2012-02
year: 2012
exam: final
tags:
  - concurrencia
  - monitores
---

Sea un puente con capacidad para un vehículo y dos accesos: norte y sur. En caso de que haya vehículos intentando entrar por los dos accesos, debe entrar un vehículo por el extremo en el que haya más esperando (si el número de vehículos esperando en cada extremo es el mismo, no es necesario imponer un orden). En el caso de que intente entrar una ambulancia, tendrá prioridad sobre el resto de vehículos. No es necesario considerar el caso en que dos ambulancias intenten acceder simultáneamente al puente. 

- (a) (3 puntos) Se  pide  desarrollar  una  clase  monitor  `GestorPuente`  que  gestione  el  acceso  al  puente,  según  la especificación  previa.  Los  métodos  de  esta  clase  no  retornan  valores.  El  esqueleto  de  la  clase  es  el siguiente:

```java
public class GestorPuente {
    ... void entrarNorte () { ...}
    ... void entrarSur () { ...}
    ... void entrarAmbulancia () { ...}
    ... void salirPuente(){...}
}
```

??? note "Mostrar solución"
    Una posible solución es:
    ```java
    package es.upm.dit.adsw.puenteTurnoEspera;
    /**
    * Monitor que gestiona la entrada a un puente de coches
    * por sus dos extremos (norte y sur). Dentro el puente sólo puede
    * haber un coche. Si hay coches esperando en sus dos extremos, entra
    * uno por el extremos con más coches esperando. Si intenta entrar una
    * ambulancia, tendrá prioridad. No pueden intentar dos ambulancias
    * simultaneamente.
    */
    public class GestorPuente { // monitor
    /**
    * Indica si hay un coche dentro del puente
    */
    private boolean hayCocheEnPuente = false;
    /**
    * Indica el número de coches que están esperando
    *  para entrar en el puente por el Norte
    */
    private int nCochesNorte = 0;
    /**
    * Indica el número de coches que están esperando
    *  para entrar en el puente por el Sur
    */
    private int nCochesSur = 0;
    /**
        Indica si hay una ambulancia esperando.

    */
    private boolean hayAmbulancia = false;
    /**
    * Método que ejecutan los coches que quiere entrar por el norte.
    *  El coche entrará en el puente cuando esté vacío, no haya más
    *  coches esperando en el sur y no haya ambulancias.
    */
    public synchronized void entrarNorte() throws InterruptedException {
        nCochesNorte++;
        !!while (hayCocheEnPuente || hayAmbulancia || nCochesNorte < nCochesSur)
            wait();
        hayCocheEnPuente = true;
        nCochesNorte--;
    }

    /**
    * Método que ejecutan los coches que quiere entrar por el sur.
    * El coche entrará en el puente cuando esté vacío, no haya más
    * coches esperando en el sur y no haya ambulancias.
    */
    public synchronized void entrarSur() throws InterruptedException {
        nCochesSur++;
        while (hayCocheEnPuente || hayAmbulancia || nCochesSur < nCochesNorte)
        wait();
        hayCocheEnPuente = true;
        nCochesSur--;
    }
    /**
    * Método que ejecutan las ambulancias
    */
    public synchronized void entrarAmbulancia() throws InterruptedException {
        hayAmbulancia = true;
        while (hayCocheEnPuente) wait();
        hayCocheEnPuente = true;
        hayAmbulancia = false;
    }

    /**
    * Método que invoca un coche que está en el puente al salir de él.
    */
    public synchronized void salirPuente() {
        hayCocheEnPuente = false;
        notifyAll();
    }
    }
    ```
