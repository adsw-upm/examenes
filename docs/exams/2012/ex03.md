---
id: ex-2012-03
year: 2012
exam: final
tags:
  - android
  - actividades
---


Tenemos una aplicación de Android que calcula la nota de ADSW como se muestra a continuación.

| | |
|---|---|
| ![Figura de la aplicación](./extra/img-004.png) | ![Figura de la aplicación](./extra/img-005.png) |
| ![Figura de la aplicación](./extra/img-002.png) | ![Figura de la aplicación](./extra/img-003.png) |

Como hemos visto, la aplicación consta de dos pantallas, un formulario inicial (`NotaMediaActivity`) y  una pantalla que muestra  una foto y  el resultado (`ResultadoActivity`). Ambas clases están en el paquete `es.upm.dit.adsw`.

El cálculo de  la nota media se realiza de la siguiente forma:
    - Sólo se hace media si ambas notas  son mayores o iguales a 4. 
    - La nota es 0.6 $\cdot$ * nota de de examen + 0.4 * nota de trabajo

- (a) (1 punto) Complete el código del fichero de manifiesto del listado 1 para que la aplicación muestre la pantalla inicial (formulario) y pueda pasar a la segunda de resultado con la media.

- (b)(2 puntos) Programe la actividad `NotaMediaActivity`. Debe tener en cuenta:
    - Si el usuario no rellena un campo o introduce un valor no numérico, debe mostrar un mensaje indicándole que debe introducir valores numéricos (use un `Toast`).
    - La actividad `ResultadoActivity` espera recibir una intención con dos parámetros extra: 
        - un primer parámetro de tipo boolean denominado `aprobado` (`true` si cumple umbrales y media > = 5; `false` en caso contrario)
        - un segundo parámetro de tipo `String` denominado `valor` (contiene un mensaje indicando qué umbral no se ha superado si no se puede hacer la media, o bien el valor de la nota media).
    - Los listados 2 y 3 le proporcionan información del layout de `NotaMediaActivity` y las cadenas string.xml de la aplicación.

---

Listado 1. Código de AndroidManifest.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="COMPLETAR POR EL ALUMMNO" <!-- COMPLETAR -->
    android:versionCode="1"
    android:versionName="1.0" >
    <uses-sdk android:minSdkVersion="10" />
    <application
        android:icon="@drawable/ic_launcher"
        android:label="@string/app_name" 
     >
       <!-- COMPLETAR POR EL ALUMNO -->
</manifest>
```

Listado 2.  Código de layout/ notamedia_final.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<TableLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent" 
    android:background="@drawable/notebook"
    android:paddingLeft="40dp"
    android:paddingRight="5dp" >
    <TableRow>
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/nota_examen" />
        <EditText
            android:id="@+id/editText_examen_final"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:ems="10"
            android:inputType="number|numberDecimal" >
            <requestFocus />
        </EditText>
    </TableRow>
    <TableRow>
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/nota_trabajo" />
        <EditText
            android:id="@+id/editText_trabajo_final"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:ems="10"
            android:inputType="number|numberDecimal" >
        </EditText>
    </TableRow>
    <TableRow
        android:gravity="center">
        <Button
            android:id="@+id/button_calcular"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/calcular" />
    </TableRow>
</TableLayout>
```

Listado 3. Código de values/strings.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <string name="app_name">NotaMediaADSW</string>
    <string name="nota_trabajo">Nota trabajo final</string>
    <string name="nota_examen">Nota examen final</string>
    <string name="nota_media">Nota media</string>
    <string name="calcular">Calcular</string>
    <string name="error_numero">Los campos deben ser numéricos</string>
    <string name="umbral_trabajo">No has superado el umbral de 4.0 en la práctica</string>
    <string name="umbral_examen">No has superado el umbral de 4.0 en el examen</string>        
     <string name="enhorabuena">Enhorabuena, que pases un buen verano.</string>
    <string name="julio">Hay otra oportunidad en julio. </string>
    <string name="nota">La nota es </string>
    <string name="problema_nota">Hay un problema para mostrar la nota</string>
</resources>
```

??? note "Mostrar solución"
    Una posible solución es:
    
    ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <manifest xmlns:android="http://schemas.android.com/apk/res/android"
        package="es.upm.dit.adsw"
        android:versionCode="1"
        android:versionName="1.0" >
        <uses-sdk android:minSdkVersion="10" />
        <application
            android:icon="@drawable/ic_launcher"
            android:label="@string/app_name" 
        >
            <activity
                android:name=".NotaMediaActivity"
                android:label="@string/app_name" >
                <intent-filter>
                    <action android:name="android.intent.action.MAIN" />
                    <category android:name="android.intent.category.LAUNCHER" />
                </intent-filter>
            </activity>
            <activity
                android:name=".ResultadoActivity"
                android:label="@string/app_name" />
        </application>
    </manifest>
    ```
    
    ```java
    public class NotaMediaActivity extends Activity {
    public static final String APROBADO = "nota";
    public static final String VALOR = "valor";
    private static final String TAG = NotaMediaActivity.class.getSimpleName();
    private EditText editNotaFinal;
    private EditText editTrabajoFinal;
    private Button buttonGuardar;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        Log.d(TAG, "onCreate");
        super.onCreate(savedInstanceState);
        setContentView(R.layout.notamedia_final);
        editNotaFinal = (EditText) findViewById(R.id.editText_examen_final);
        editTrabajoFinal = (EditText) findViewById(R.id.editText_trabajo_final);
        buttonGuardar = (Button) findViewById(R.id.button_calcular);
        buttonGuardar.setOnClickListener(new ProcesaMedia());
    }

    private class ProcesaMedia implements OnClickListener {
        @Override
        public void onClick(View v) {
        try {
            float notaFinal = Float.parseFloat(editNotaFinal.getText().toString());
            float notaTrabajo =
                Float.parseFloat(editTrabajoFinal.getText().toString());
            if ((notaFinal < 0) || (notaFinal > 10) || (notaTrabajo < 0)
                || (notaTrabajo > 10)) {
            Toast
                .makeText(getApplication(), getString(R.string.error_numero),
                    Toast.LENGTH_LONG)
                .show();
            return;
            }
            float media = (0.6f * notaFinal) + (0.4f * notaTrabajo);
            DecimalFormat df = new DecimalFormat("#.##");
            String mediaString = df.format(media);
            boolean aprobado = false;
            String valor = "";
            if ((notaTrabajo < 4) || (notaFinal < 4)) {
            aprobado = false;
            if (notaTrabajo < 4) {
                valor += " " + getString(R.string.umbral_trabajo);
            }
            if (notaFinal < 4) {
                valor += " " + getString(R.string.umbral_examen);
            }
            } else {
            valor = mediaString;
            aprobado = (media >= 5);
            }
            Intent intent = new Intent(getApplication(), ResultadoActivity.class);
            intent.putExtra(APROBADO, aprobado);
            intent.putExtra(VALOR, valor);
            Log.d(TAG, "Nota " + aprobado + " " + valor);
            startActivity(intent);
        } catch (NumberFormatException e) {
            Toast
                .makeText(getApplication(), getString(R.string.error_numero),
                    Toast.LENGTH_LONG)
                .show();
        }
        }
    }
    }
    ```

