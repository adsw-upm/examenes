---
id: ex-2014-01
year: 2014
exam: parcial 2
tags:
 - android
---

En la práctica 2 (Pacman en Android) deseamos añadir una nueva funcionalidad: que los jugadores ganen puntos. Consideraremos que cada escenario tiene sólo un jugador. El jugador ganará 1 punto cada vez que se mueva y avance una casilla.

Además, deseamos que al guardar una partida en la base de datos se almacene la puntuación, y que se recupere cuando se carga la partida. Al cargar una partida almacenada, se desea que `DbLoadActivity` muestre una lista de las partidas guardadas, mostrando en cada fila el nombre de la partida y los puntos obtenidos.

- (a) (5 puntos) Indique qué clases de la práctica debe modificar y cómo. Incluya exclusivamente las modificaciones realizadas. No hace falta que escriba completas las cabeceras de los métodos. En caso de que tenga varias alternativas, justifique y discuta su respuesta. 

Nota: En `MyDbAdapter`, basta con que indique las modificaciones necesarias para crear la tabla e insertar una nueva partida.

??? note "mostrar solución"
    Debemos añadir un campo puntos. Se puede añadir en Escenario o en Jugador.

    - Jugador
    
    ```java
    private int puntos;
    ...
    public int getPuntos() { return puntos; }
    public void setPuntos(int puntos) { this.puntos = puntos; }
    public void incrementa(int puntos) { this.puntos += puntos; }
    
    private Jugador() { ...
        puntos = 0;
    }
    ```
    
    - Terreno, método move
    
    ```java
    public synchronized Casilla move(Movil movil, Direccion direccion) {
        origen.setMovil(null);
        destino.setMovil(movil);
        movil.setCasilla(destino);
        jugador.incrementa(1);
        ...
    }
    ```
    
    - `MyDbAdapter`
    
        - En `DatabaseHelper`, debemos cambiar el String para crear la tabla, añadiendo una columna:
    
    ```sql
    CREATE TABLE TABLE_FOTOS (id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT, moviles TEXT, casillas TEXT, date TEXT, puntos INT);
    ```
    
        - `inserfFoto()`
    
    ```java
    public static final String COL_PUNTOS = "puntos";
    
    public long insertFoto(String name) {
        Escenario escenario = Escenario.getInstance();
        Jugador jugador = escenario.getTerreno().getJugador();
        ContentValues values = new ContentValues();
        values.put(COL_NAME, name);
        values.put(COL_MOVILES, DbUtils.getStringMoviles(terreno));
        values.put(COL_CASILLAS, DbUtils.getStringCasillas(terreno));
        values.put(COL_DATE, prepareDate());
        values.put(COL_PUNTOS, escenario.getPuntos());
        return db.insert(TABLE_FOTOS, null, values);
    }
    ```
    
    - `DbLoadActivity`
    
    ```java
    public class DbLoadActivity extends ListActivity {
        private static final String TAG = “DbLoadActivity";
    
        @Override
        protected void onCreate(Bundle savedInstanceState) { ...
            String[] columns = { MyDbAdapter.COL_NAME, MyDbAdapter.COL_PUNTOS};
            ...
        }
    
        protected void onListItemClick(ListView listView,
            View view, int position, long id) {
            ...
            Jugador jugador = escenario.getTerreno().getJugador();
            jugador.setPuntos(cursor.getInt(cursor.getColumnIndex(
                MyDbAdapter.COL_PUNTOS));
        }
        ...
    }
    ```
