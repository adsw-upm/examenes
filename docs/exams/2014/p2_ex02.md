---
id: ex-2014-02
year: 2014
exam: parcial 2
tags:
 - android
---

Conteste a las siguientes preguntas:

- (a) (1,5 puntos) En un layout existe un widget de tipo EditText con id “telefono”. Escribir el código que extrae lo tecleado por el usuario en el widget y genera una traza con el contenido.

??? note "Mostrar solución"
    ```java
    EditText telefono = (EditText) findViewById(R.id.telefono);
    String numero = telefono.getText().toString();
    Log.i.(TAG, “Teléfono: “ + numero);
    ```


- (b) (1,5 puntos) Estando en una actividad se desea pasar a otra actividad llamada PantallaActivity. Escribir el código necesario para lanzar esta actividad pasándole un parámetro entero llamado “n”.

??? note "Mostrar solución"
    ```java
    Intent intent = new Intent(this, PantallaActivity.class);
    intent.putExtra("n", n);
    startActivity(intent);
    ```

- (c) (2 puntos) Necesitamos enviar un mensaje (String M) a una larga lista de destinatarios cuyas direcciones de email tenemos en una lista de direcciones `List<Email>`. Tenemos un método para enviar un correo:

```java
boolean send(Email direccion, String mensaje)
```

Como este método puede ser lento, usaremos una AsyncTask para el envío a la lista. Suponga que llamamos al método execute() pasándole como parámetro la String M. Escriba la cabecera y
cuerpo del método de la AsyncTask que se ejecuta en otra hebra (thread) de forma que ocurra lo siguiente:
    - cada vez que termina el envío de un mensaje, se lanza un Toast en la UI-thread con un mensaje que pone el email y el boolean que ha devuelto el método send()
    - el resultado final es el tiempo transcurrido en la hebra asíncrona en milisegundos (un entero largo)

??? note "Mostrar solución"
    ```java
    class Correo extends AsyncTask<String,String, Long> {
        List<Email> direcciones ...;

        protected void onPreExecute() {...} // se ejecuta en la UIThread

        // se ejecuta en una nueva hebra, diferente de la UI Thread
        @Override
        protected Long doInBackground(final String... params) {
            Long t0 = System.currentTimeMillis();
            String mensaje = params[0];
            for (Email direccion : direcciones) {
                boolean enviado = send(direccion, mensaje);
                String resultado = direccion + ": “ + enviado;
                publishProgress(resultado);
            }
            Long t1 = System.currentTimeMillis();
            return t1 - t0;
        }

        protected void onProgressUpdate(String... message) {...} // en la UIThread
        protected void onPostExecute(Long result) {...} // en la UIThread
    }
    ```

    Sólo se da el código del método doInBackground, dado que los otros métodos se ejecutan en la UIThread. En particular, los Toast que se mencionan en el enunciado se lanzan desde los métodos     onProgressUpdate y onPostExecute, que se ejecutan en la hebra principal (UIThread).

