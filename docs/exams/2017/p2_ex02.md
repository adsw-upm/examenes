---
id: ex-2017-02
year: 2017
exam: parcial 2
tags:
 - android
---

Tras numerosos e infructuosos intentos, España ha vuelto a ganar el festival de Eurovisión. Como país organizador, debe desarrollar una aplicación móvil para facilitar el televoto. Su misión es completar el código de la aplicación que se detalla a continuación.

La aplicación consta de dos pantallas: `MainActivity` y `VotacionActivity`, como se ilustra en la figura.

En la primera pantalla, el usuario introduce su país (p.ej. España) y puede elegir entre votar o listar canciones (esta última utilidad no es misión suya). Una vez escrito el país del usuario, si pincha en el botón 'Votación', pasa a la segunda pantalla `VotacionActivity`.

En la segunda pantalla, `VotacionActivity`, el usuario puede realizar dos acciones. La primera es indicar a qué país vota (p.ej. Italia) y cuántos puntos le da (p.ej. 10), y pulsar el botón 'Votar'. La segunda sería no realizar la votación (pulsando el botón 'Cancelar'). Si el usuario pulsa el botón 'Votar', vuelve a la primera pantalla, y se muestra en un mensaje la votación realizada.

![](./p2/p2_ex02.png)

- (a) (2 puntos) Se pide que complete el código proporcionado en esta hoja de respuestas. Tenga que cuenta que sólo se entregará una hoja.

Tal como se indica en la figura, de la `Actividad` `MainActivity` se pasa a `VotacionActivity` pasando la clave `country_voting` y el valor `String` introducido. De la segunda pantalla `VotacionActivity`, si el usuario pulsa en 'Votación', pasa a `MainActivity` pasándole los datos `country_voting` (valor `String` inicial recibido), `country_voted` (`String` del país votado) y `votes` (entero de los puntos).

Debe completar cómo `MainActivity` pasa a `VotacionActivity` y cómo recibe estos valores. No tenga en cuenta casos anómalos (un valor no está relleno o no se ha pasado un valor entre actividades)

??? note "Mostrar solución"
    ```java
    public class MainActivity extends AppCompatActivity {
    
        private static final String TAG = MainActivity.class.getName();
        private static final int OBTENER_VOTOS = 0;
    
        private TextView resultado;
        private EditText paisVotanteEditText;
    
        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            setContentView(R.layout.activity_main);
    
            Button botonVotar = (Button) findViewById(R.id.botonVotacion);
            paisVotanteEditText = (EditText) findViewById(R.id.editTextPaisVotante);
            resultado = (TextView) findViewById(R.id.textViewResultado);
    
            botonVotar.setOnClickListener(new View.OnClickListener() {
                @Override
                public void onClick(View view) {
                    String country = paisVotanteEditText.getText().toString();
                    Intent intent = new Intent(
                            MainActivity.this,
                            VotacionActivity.class
                    );
                    intent.putExtra("country_voting", country);
                    startActivityForResult(intent, OBTENER_VOTOS);
                }
            });
        }
    
        @Override
        protected void onActivityResult(int requestCode, int resultCode, Intent data) {
            super.onActivityResult(requestCode, resultCode, data);
    
            if (requestCode == OBTENER_VOTOS) {
                if (resultCode == RESULT_OK) {
                    Bundle extras = data.getExtras();
                    String paisVotante = extras.getString("country_voting");
                    String paisVotado = extras.getString("country_voted");
                    int votos = extras.getInt("votes");
    
                    String msg = votos + " votos recibidos de "
                            + paisVotante + " para " + paisVotado;
    
                    paisVotanteEditText.setEnabled(false);
                    resultado.setText(msg);
                    resultado.setVisibility(View.VISIBLE);
                }
            }
        }
    }
    ```
