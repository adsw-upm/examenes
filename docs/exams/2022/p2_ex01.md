---
id: ex-2022-01
year: 2022
exam: parcial 2
tags:
 - hebras
---

Se dispone un puente elevado para automóviles. Se quiere desarrollar un sistema de seguridad que impide que haya más de 10 vehículos simultáneamente en el puente y con un peso total mayor que 15.000 Kg.

Cuando un vehículo quiere entrar en el puente, ejecuta el método `entrarPuente` y cuando lo abandona, ejecuta el método `salirPuente`. Las ambulancias tienen que invocar el método `entrarPuenteAmbulancia` para tener prioridad en el acceso.

- (a) (1,5 puntos) Desarrolle el monitor con las restricciones indicadas como se muestra en la plantilla que se muestra a continuación. NOTA: El parámetro peso en cada método se refiere al peso del vehículo. No es imprescindible proporcionar una solución sin hambruna. Si lo hubiera se debería indicarlo y justificarlo.
    
```java
public class GestorPuenteSeguro {
    private static final int pesoMax = 15000;
    private static final int nVehiculosMax = 10;
    . . .

    /*
     * Un vehículo invoca este método para entrar en el puente. Se bloquea para no exceder en
     * el número de vehículos, el peso total en el puente o si hay ambulancias esperando.
     */
    . . . void entrarPuente(int peso) . . .

    /*
     * Una ambulancia invoca este método para entrar en el puente. Se bloquea para no exceder en
     * el número de vehículos o el peso total en el puente.
     */
    . . . void entrarPuenteAmbulanica(int peso) . . .

    /*
     * Los vehículos invocan este método cuando van a salir del puente
     */
    . . . void salirPuente(int peso) . . .
}
```

??? note "Mostrar solución" 
    A continuación, se propone una solución al enunciado, que satisface los requisitos de sincronización condicional generales planteados. Además, se asegura que no van a ocurrir interbloqueos.

    Esta solución no evita la hambruna. Si continuamente intentan a entrar ambulancias, podría ocurrir que ningún coche podría acceder. Igualmente, los vehículos con poco peso tienen más probabilidad de entrar al puente que los vehículos con mayor peso. En situaciones desfavorables, podría ocurrir la hambruna para los vehículos más pesados.

    ```java
    package es.upm.dit.adsw.puente_limitado;

    public class PuenteSeguro {
        private int pesoEnPuente = 0;
        private int nVehiculos = 0;
        private int nAmbulanciasEsperando = 0;
        private static final int pesoMaximo = 15000;
        private static final int nVehiculosMaximo = 10;

        public synchronized void entrarPuente(int peso) throws InterruptedException {
            while ((peso + pesoEnPuente > pesoMaximo) ||
                   (nVehiculos >= nVehiculosMaximo) ||
                   (nAmbulanciasEsperando > 0)) {
                wait();
            }
            pesoEnPuente = pesoEnPuente + peso;
            nVehiculos++;
        }

        public synchronized void entrarPuenteAmbulancia(int peso) throws InterruptedException {
            nAmbulanciasEsperando++;
            while ((peso + pesoEnPuente > pesoMaximo) ||
                   (nVehiculos >= nVehiculosMaximo)) {
                wait();
            }
            nAmbulanciasEsperando--;
            pesoEnPuente = pesoEnPuente + peso;
            nVehiculos++;
        }

        public synchronized void salirPuente(int peso) throws InterruptedException {
            pesoEnPuente = pesoEnPuente - peso;
            nVehiculos--;
            notifyAll();
        }
    }
    ```