---
id: ex-2022-01
year: 2022
exam: parcial 2
tags:
 - hebras
---

Se dispone un puente elevado para autom!viles. Se quiere desarrollar un sistema de seguridad que impide que hayan m"s de 10 veh#culos simult"neamente en el puente y con un peso total mayor que 15.000 Kg.

Cuando un veh#culo quiere entrar en el puente, ejecuta el m$todo entrarPuente y cuando lo abandona, ejecuta el m$todo salirPuente. Las ambulancias tienen que invocar el m$todo entrarPuenteAmbulancia para tener prioridad en el acceso.

- (a) (1,5 puntos) Desarrolle el monitor con las restricciones indicadas como se muestra en la plantilla que se muestra a
continuaci!n. NOTA: El par"metro peso en cada m$todo se refiere al peso del veh#culo. No es imprescindible proporcionar una soluci!n sin hambruna. Si lo hubiera se deber#a indicarlo y justificarlo.
    
```java
public class GestorPuenteSeguro {
    private static final int pesoMax = 15000;
    private static final int nVehiculosMax = 10;
    . . .

    /*
     * Un vehículo invoca este método para entrar en el puente. Se bloquea para no exceder en
     * el número de vehículos, el peso total en el puente o si hay ambulancias esperando.
     */
    . . . void entrarPuente(int peso) . . .

    /*
     * Una ambulancia invoca este método para entrar en el puente. Se bloquea para no exceder en
     * el número de vehículos o el peso total en el puente.
     */
    . . . void entrarPuenteAmbulanica(int peso) . . .

    /*
     * Los vehículos invocan este método cuando van a salir del puente
     */
    . . . void salirPuente(int peso) . . .
}
```

??? note "Mostrar solución" 
    A continuaci!n, se propone una soluci!n al enunciado, que satisface los requisitos de sincronizaci!n condicional generales planteados. Adem"s, se asegura que no van a ocurrir interbloqueos.

    Esta soluci!n no evita la hambruna. Si continuamente intentan a entrar ambulancia, podr#a ocurrir que ning%n coche podr#a acceder. Igualmente, los veh#culos con poco peso tienen m"s probabilidad de entrar al puente que los veh#culos con mayor peso. En situaciones desfavorables, podr#a ocurrir la hambruna para los veh#culos m"s pesados.

    ```java
    package es.upm.dit.adsw.puente_limitado;

    public class PuenteSeguro {
        private int pesoEnPuente = 0;
        private int nVehiculos = 0;
        private int nAmbulanciasEsperando = 0;
        private static final int pesoMaximo = 15000;
        private static final int nVehiculosMaximo = 10;

        public synchronized void entrarPuente(int peso) throws InterruptedException {
            while ((peso + pesoEnPuente > pesoMaximo) ||
                   (nVehiculos >= nVehiculosMaximo) ||
                   (nAmbulanciasEsperando > 0)) {
                wait();
            }
            pesoEnPuente = pesoEnPuente + peso;
            nVehiculos++;
        }

        public synchronized void entrarPuenteAmbulancia(int peso) throws InterruptedException {
            nAmbulanciasEsperando++;
            while ((peso + pesoEnPuente > pesoMaximo) ||
                   (nVehiculos >= nVehiculosMaximo)) {
                wait();
            }
            nAmbulanciasEsperando--;
            pesoEnPuente = pesoEnPuente + peso;
            nVehiculos++;
        }

        public synchronized void salirPuente(int peso) throws InterruptedException {
            pesoEnPuente = pesoEnPuente - peso;
            nVehiculos--;
            notifyAll();
        }
    }
    ```