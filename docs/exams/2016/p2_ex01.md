---
id: ex-2016-01
year: 2016
exam: parcial 2
tags:
 - hebras
---

En un programa existe una zona crítica especial, llamémosla “supersticiosa”, en la que puede haber cualquier número de hebras, siempre que no sean trece.

- (a) (5 puntos) Se pide realizar una clase sincronizada (según el esquema que da a continuación) que realice tal protocolo de sincronización. Para simplificar el código, no tenga en cuenta la excepción que pueda presentarse en la operación `wait()`.

```java
package es.upm.dit.adsw.super;

public class Supersticiosa {
    // ...

    // quiero entrar en la zona crítica
    public synchronized void entrar() {
        // ...
    }

    // quiero salir de la zona crítica
    public synchronized void salir() {
        // ...
    }
}
```

??? note "Mostrar solución"
    ```java
    package es.upm.dit.adsw.super;

    public class Supersticioso {
        // número de peticiones de entrada a la R.C.
        // menos número de peticiones de salida de la R.C.
        private int n = 0;

        // quiero entrar en la zona crítica
        public synchronized void entrar() {
            n++;
            while (n == 13) {
                try {
                    wait();
                } catch (InterruptedException ignored) {
                }
            }
            notifyAll();
        }

        // quiero salir de la zona crítica
        public synchronized void salir() {
            n--;
            while (n == 13) {
                try {
                    wait();
                } catch (InterruptedException ignored) {
                }
            }
            notifyAll();
        }
    }
    ```

    Otra posible solución para una interpretación diferente del enunciado es:

    ```java
    public class Supersticioso {
        private int nDentro = 0;

        public synchronized void entrar() {
            while (nDentro + 1 == 13) {
                try {
                    wait();
                } catch (InterruptedException ignored) {
                }
            }
            nDentro++;
        }

        public synchronized void salir() {
            nDentro--;
            notifyAll();
        }
    }
    ```