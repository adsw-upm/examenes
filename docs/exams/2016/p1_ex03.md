---
id: ex-2016-03
year: 2016
exam: parcial 1
tags:
 - complejidad
---

- (a) (1 punto) Modifique la clase Sensor para que se pueda integrar en una hebra que comparta información con los sensores cercanos cada 30 s. Para ello se puede implementar la interfaz Runnable.

```java
public class Sensor implements Runnable {
    // ...
    private Red red;
    private int medida; // valor leído por el sensor

    public Sensor(String id, int x, int y, Red red) {
        this.red = red;
    }

    @Override
    public void run() {
        while (true) {
            try {
                // transmitir la lectura cada 30 segundos
                red.transmitir(this, medida);
                Thread.sleep(30000); // 30 s
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                break;
            }
        }
    }
}
```

??? note "Mostrar solución"
    Para implementar la interfaz Runnable espreciso redefinir el método run():
    ```java
    @Override
    public void run() {
        while (true) {
            try {
                sleep(30000);
            } catch (InterruptedException ignored) {
            }

            for (Sensor s : red.cercanos(f).get(this)) {
                red.enviar(s, medida);
            }
        }
    }
    ```


- (b) (1 punto) Escriba una línea de código java para arrancar una hebra que ejecute el código concurrente de Sensor.


??? note "Mostrar solución"
    Para arrancar una hebra que ejecute el método run() anterior hay que crear la hebra a partir del Runnable y hacer start():
    ```java
    new Thread(new Sensor()).start();
    ```
    o alternativamente:
    ```java
    Runnable sensor = new Sensor(…);
    Thread tread = new Thread(sensor);
    thread.start();
    ```


- (c) (1 punto) En el puesto de mando y control, un servidor ejecuta un programa basado en la clase Red de las preguntas anteriores, y recibe peticiones de los operadores locales y de los muchos sensores distribuidos por Madrid. Modifique la clase Red para que pueda atender cargas, recargas y peticiones concurrentes sin problemas de concurrencia.


NOTAS
1. Suponga que el valor medido por el sensor (medida) se actualiza automáticamente por algún mecanismo que no es relevante para examen.
2. Suponga que la clase Red incluye el método
```java
public void enviar (Sensor destino, int medida) {…}
```


??? note "Mostrar solución"
    Para que la clase Red se pueda usar de forma segura desde varias hebras es preciso convertirla en un monitor. Como no tiene atributos públicos basta para ello con sincronizar todos sus métodos públicos:
    ```java
    public class Red {
        private Diccionario diccionario = new DiccionarioImpl();

        public synchronized void cargar(List<Sensor> sensores, double d0) {
            // ...
        }

        public synchronized Map<Sensor, List<Sensor>> cercanos(int f) {
            // ...
            return null;
        }

        public synchronized void enviar(Sensor destino, int medida) {
            // ...
        }
    }
    ```