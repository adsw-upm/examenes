---
id: ex-2013-02
year: 2013
exam: parcial 1
tags:
 - monitores
---

- (a) (5 puntos) 

Sean tres hebras (threads), T1, T2 y T3, que utilizan tres recursos, R1, R2 y R3.  

La hebra T1 sólo necesita el recurso R1.  

La hebra T2 necesita los recursos R2 y R3.  

Por último, la hebra T3 requiere los tres recursos, R1, R2 y R3.

Escriba un monitor que controle el acceso de las hebras a los recursos. Cada hebra solicita los recursos que necesita invocando un método del monitor. Cuando una hebra termina de usar los recursos que necesita, lo indica para que otras hebras puedan usarlos. El monitor ha de asegurar que ningún recurso es utilizado por más de una hebra a la vez.

El esqueleto del monitor con los nombres de los métodos es:

```java
class Monitor {
    …
    … requiereR1 (…) { … }
    … requiereR2_R3 (…) { … }
    … requiereR1_R2_R3 ( …) { …}
    … liberaR1(…) { … }
    … liberaR2_R3 (…) { … }
    … liberaR1_R2_R3 ( …) { …}
}
```
??? note "Mostrar solución"
    Una posible solución sería:

    ```java
    public class Monitor {
        private boolean ocupadoR1 = false;
        private boolean ocupadoR2 = false;
        private boolean ocupadoR3 = false;

        public synchronized void requiereR1 () 
                   throws InterruptedException {
            while (ocupadoR1) wait();
            ocupadoR1 = true;
        }

        public synchronized void requiereR2_R3() 
                   throws InterruptedException {
            while (ocupadoR2 || ocupadoR3) wait();
            ocupadoR2 = true;
            ocupadoR3 = true;
        }

        public synchronized void requiereR1_R2_R3 () 
                       throws InterruptedException { 
            while (ocupadoR1 || ocupadoR2 || ocupadoR3) wait();
            ocupadoR1 = true;
            ocupadoR2 = true;
            ocupadoR3 = true;
        }

        public synchronized void liberaR1() {
            ocupadoR1 = false;
            notifyAll();
        }

        public synchronized void libreraR2_R3 () {
            ocupadoR2 = false;
            ocupadoR3 = false;
            notifyAll();
        }

        public synchronized void liberaR1_R2_R3 () {
            ocupadoR1 = false;
            ocupadoR2 = false;
            ocupadoR3 = false;
            notifyAll(); 
        }
    }
    ```
