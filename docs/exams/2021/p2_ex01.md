---
id: ex-2021-01
year: 2021
exam: parcial 2 recuperacion
tags:
 - hebras
---

Se quiere desarrollar una clase monitora TorreControl para gestionar una !nica pista de aterrizaje de un aeropuerto, con acceso exclusivo por parte de objetos de la clase Avion, que ser"n las hebras. Los aviones pueden pedir a la torre de control aterrizar y despegar. Se pide desarrollar los siguientes m#todos:

![](./p1r/p1r_ex01.png)

- (a) (1,5 puntos) public … void avisoAterrizaje(Avion unAvion): para la maniobra de aterrizaje, los aviones primero avisar"n a la torre de control (con este m#todo) de su intenci$n de aterrizar y despu#s preguntar"n por el permiso para poder aterrizar. Cuando la torre de control reciba un aviso de aterrizaje deber" a%adir el avi$n que solicit$ el permiso a una lista. Esta lista se ordenar" por el combustible que tengan los aviones, siendo el que tenga menos combustible el primero de la lista y el primero en aterrizar (en caso de haber dos aviones con el mismo combustible ser" indiferente el orden de aterrizaje entre ellos).

- (b) (2 puntos) public … void permisoAterrizaje(Avion unAvion): un avi$n invoca este m#todo para pedir permiso para aterrizar. Cuando la torre de control reciba la llamada de permiso de aterrizaje entonces solo dejar" aterrizar al avi$n si lo tiene guardado en la lista de menos combustible y si la pista est" libre. 

- (c) (1,5 puntos) public … void permisoDespegue(Avion unAvion para la maniobra de despegue los aviones pedir"n permiso para despegar. Se supone que todos los aviones tienen el m"ximo de combustible y no hay prioridad, as& que cuando pidan despegar podr"n hacerlo siempre y cuando la pista est# libre.

Aclaraciones sobre el ejercicio:

    - En la clase TorreControl se controla cuándo la pista está ocupada o libre. La pista estará ocupada cuando un avión ha recibido permiso a través de los métodos permisoAterrizaje o permisoDespegue. La pista se debe marcar como ocupada dentro de este método cuando un avión tiene permiso y se mantiene así en un tiempo, representado como Thread.sleep(random.nextInt(5000)). Al expirar este temporizador, la pista se marcará como libre.
    
    - Para simplificar este ejercicio, se supone que un avión mantiene constante su nivel de combustible, desde que notifica su intención de aterrizar (con el método avisoAterrizaje) hasta que recibe el permiso (con el método permisoAterrizaje).

    - Se dispone un método (no es necesario implementarlo) que recibe una lista de aviones y retorna una lista de aviones ordenada de menor a mayor por el combustible del avión: List<Avion> ordenarAvionesPorCompustible(List<Avion> listaAviones))

```java
// Ejemplo del posible código de una hebra de la clase Avion

public class Avion extends Thread {

    private TorreControl miTorre;
    private int combustible;
    private String matricula;

    public Avion(TorreControl miTorre, String matricula, int combustible) {
        this.miTorre = miTorre;
        this.matricula = matricula;
        this.combustible = combustible;
    }

    public int getCombustible() {
        return this.combustible;
    }

    public String getMatricula() {
        return this.matricula;
    }

    @Override
    public void run() {
        while (true) {
            try {
                this.miTorre.avisoAterrizaje(this);
                this.miTorre.permisoAterrizaje(this);
                this.miTorre.permisoDespegue(this);
            } catch (InterruptedException ignored) {
            }
        }
    }
}
```

```java
public static void main(String[] args) throws Exception {

    TorreControl tc = new TorreControl("Barajas");

    new Avion(tc, "aaa", 30).start();
    new Avion(tc, "bbb", 10).start();
    new Avion(tc, "ccc", 20).start();
    new Avion(tc, "ddd", 50).start();
    new Avion(tc, "eee", 5).start();
}
```

??? note "Mostrar solución" 

    ```java
    import java.util.*;

    public class TorreControl {

        private String nombre;
        private List<Avion> listaAterrizaje = new ArrayList<Avion>();
        private volatile boolean pistaOcupada = false;
        private Random random = new Random();

        public TorreControl(String nombre) {
            this.nombre = nombre;
        }

        public synchronized void avisoAterrizaje(Avion miAvion) {
            listaAterrizaje.add(miAvion);
            // Se ha elegido esta forma de ordenación pero puede hacerse de varias formas.
            Collections.sort(this.listaAterrizaje, new OrdenarPorCombustible());
            System.out.println(
                "Torre control - Añadido avión a la lista ordenada. "
                + this.listaAterrizaje.toString()
            );
        }

        public synchronized void permisoAterrizaje(Avion miAvion) {
            try {
                System.out.println(
                    "Torre control - Primer avión en lista: "
                    + this.listaAterrizaje.get(0).toString()
                );

                while ((this.pistaOcupada == true) ||
                       (listaAterrizaje.get(0) != miAvion)) {
                    wait();
                }

                this.pistaOcupada = true;
                System.out.println(
                    "Torre control - "
                    + miAvion.toString()
                    + " Aterrizando (región crítica)."
                );

                // Duerme entre 0 y 5 seg. para simular el uso de la pista
                Thread.sleep(random.nextInt(10000));

                this.pistaOcupada = false;
                listaAterrizaje.remove(0);
                notifyAll();

            } catch (InterruptedException ignored) {
            }
        }

        public synchronized void permisoDespegue(Avion miAvion) {
            try {
                while (this.pistaOcupada == true) {
                    wait();
                }

                this.pistaOcupada = true;
                System.out.println(
                    "Torre control - "
                    + miAvion.toString()
                    + " Despegando (región crítica)."
                );

                // Duerme entre 0 y 5 seg. para simular el uso de la pista
                Thread.sleep(random.nextInt(10000));

                this.pistaOcupada = false;
                notifyAll();

            } catch (InterruptedException ignored) {
            }
        }
    }
    ```
